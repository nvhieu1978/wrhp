<!DOCTYPE html>
<!-- saved from url=(0074)https://plutus-pioneer-program.readthedocs.io/en/latest/pioneer/week1.html -->
<html class="writer-html5" lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>1. Week 01 - English Auction — Plutus Pioneer Program Lecture Notes  documentation</title>
  

  
  <link rel="stylesheet" href="./1. Week 01 - English Auction Plutus Pioneer Program_files/theme.css" type="text/css">
  <link rel="stylesheet" href="./1. Week 01 - English Auction Plutus Pioneer Program_files/pygments.css" type="text/css">
  <link rel="stylesheet" href="./1. Week 01 - English Auction Plutus Pioneer Program_files/pygments.css" type="text/css">
  <link rel="stylesheet" href="./1. Week 01 - English Auction Plutus Pioneer Program_files/theme.css" type="text/css">
  <link rel="stylesheet" href="./1. Week 01 - English Auction Plutus Pioneer Program_files/custom.css" type="text/css">

  
  

  
  

  
    <link rel="canonical" href="https://plutus-pioneer-program.readthedocs.io/en/latest/pioneer/week1.html">

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" async="" src="./1. Week 01 - English Auction Plutus Pioneer Program_files/analytics.js.tải xuống"></script><script type="text/javascript" id="documentation_options" data-url_root="../" src="./1. Week 01 - English Auction Plutus Pioneer Program_files/documentation_options.js.tải xuống"></script>
        <script data-url_root="../" id="documentation_options" src="./1. Week 01 - English Auction Plutus Pioneer Program_files/documentation_options.js.tải xuống"></script>
        <script src="./1. Week 01 - English Auction Plutus Pioneer Program_files/jquery.js.tải xuống"></script>
        <script src="./1. Week 01 - English Auction Plutus Pioneer Program_files/underscore.js.tải xuống"></script>
        <script src="./1. Week 01 - English Auction Plutus Pioneer Program_files/doctools.js.tải xuống"></script>
        <script async="async" src="./1. Week 01 - English Auction Plutus Pioneer Program_files/readthedocs-doc-embed.js.tải xuống"></script>
    
    <script type="text/javascript" src="./1. Week 01 - English Auction Plutus Pioneer Program_files/theme.js.tải xuống"></script>

    
    <link rel="index" title="Index" href="https://plutus-pioneer-program.readthedocs.io/en/latest/genindex.html">
    <link rel="search" title="Search" href="https://plutus-pioneer-program.readthedocs.io/en/latest/search.html">
    <link rel="next" title="2. Week 02 - Validation" href="https://plutus-pioneer-program.readthedocs.io/en/latest/pioneer/week2.html">
    <link rel="prev" title="Plutus Pioneer Program &amp; Alonzo Testnet Notes" href="https://plutus-pioneer-program.readthedocs.io/en/latest/index.html"> 

<!-- RTD Extra Head -->

<link rel="stylesheet" href="./1. Week 01 - English Auction Plutus Pioneer Program_files/readthedocs-doc-embed.css" type="text/css">

<script type="application/json" id="READTHEDOCS_DATA">{"ad_free": false, "api_host": "https://readthedocs.org", "build_date": "2021-09-12T20:44:13Z", "builder": "sphinx", "canonical_url": null, "commit": "1d0b94a2", "docroot": "/docs/", "features": {"docsearch_disabled": false}, "global_analytics_code": "UA-17997319-1", "language": "en", "page": "pioneer/week1", "programming_language": "words", "project": "plutus-pioneer-program", "proxied_api_host": "/_", "source_suffix": ".rst", "subprojects": {}, "theme": "sphinx_rtd_theme", "user_analytics_code": "", "version": "latest"}</script>

<!--
Using this variable directly instead of using `JSON.parse` is deprecated.
The READTHEDOCS_DATA global variable will be removed in the future.
-->
<script type="text/javascript">
READTHEDOCS_DATA = JSON.parse(document.getElementById('READTHEDOCS_DATA').innerHTML);
</script>

<script type="text/javascript" src="./1. Week 01 - English Auction Plutus Pioneer Program_files/readthedocs-analytics.js.tải xuống" async="async"></script>

<!-- end RTD <extrahead> -->
<script src="./1. Week 01 - English Auction Plutus Pioneer Program_files/js" type="text/javascript" async=""></script><script src="./1. Week 01 - English Auction Plutus Pioneer Program_files/ethicalads.min.js.tải xuống" type="text/javascript" async="" id="ethicaladsjs"></script><style>[data-ea-publisher].loaded,[data-ea-type].loaded{font-size:14px;font-family:-apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Helvetica Neue, Arial, Noto Sans, sans-serif, Apple Color Emoji, Segoe UI Emoji, Segoe UI Symbol, Noto Color Emoji;font-weight:normal;font-style:normal;leter-spacing:0px;vertical-align:baseline;line-height:1.3em}[data-ea-publisher].loaded a,[data-ea-type].loaded a{text-decoration:none}[data-ea-publisher].loaded .ea-pixel,[data-ea-type].loaded .ea-pixel{display:none}[data-ea-publisher].loaded .ea-content,[data-ea-type].loaded .ea-content{margin:1em 1em 0.5em 1em;padding:1em;background:rgba(0,0,0,0.03);color:#505050}[data-ea-publisher].loaded .ea-content a:link,[data-ea-type].loaded .ea-content a:link{color:#505050}[data-ea-publisher].loaded .ea-content a:visited,[data-ea-type].loaded .ea-content a:visited{color:#505050}[data-ea-publisher].loaded .ea-content a:hover,[data-ea-type].loaded .ea-content a:hover{color:#373737}[data-ea-publisher].loaded .ea-content a:active,[data-ea-type].loaded .ea-content a:active{color:#373737}[data-ea-publisher].loaded .ea-content a strong,[data-ea-publisher].loaded .ea-content a b,[data-ea-type].loaded .ea-content a strong,[data-ea-type].loaded .ea-content a b{color:#088cdb}[data-ea-publisher].loaded .ea-callout a:link,[data-ea-type].loaded .ea-callout a:link{color:#6a6a6a}[data-ea-publisher].loaded .ea-callout a:visited,[data-ea-type].loaded .ea-callout a:visited{color:#6a6a6a}[data-ea-publisher].loaded .ea-callout a:hover,[data-ea-type].loaded .ea-callout a:hover{color:#505050}[data-ea-publisher].loaded .ea-callout a:active,[data-ea-type].loaded .ea-callout a:active{color:#505050}[data-ea-publisher].loaded .ea-callout a strong,[data-ea-publisher].loaded .ea-callout a b,[data-ea-type].loaded .ea-callout a strong,[data-ea-type].loaded .ea-callout a b{color:#088cdb}[data-ea-publisher].loaded .ea-callout a,[data-ea-type].loaded .ea-callout a{font-size:0.8em}[data-ea-publisher].loaded.dark .ea-content,[data-ea-type].loaded.dark .ea-content{background:rgba(255,255,255,0.05);color:#dcdcdc}[data-ea-publisher].loaded.dark .ea-content a:link,[data-ea-type].loaded.dark .ea-content a:link{color:#dcdcdc}[data-ea-publisher].loaded.dark .ea-content a:visited,[data-ea-type].loaded.dark .ea-content a:visited{color:#dcdcdc}[data-ea-publisher].loaded.dark .ea-content a:hover,[data-ea-type].loaded.dark .ea-content a:hover{color:#f6f6f6}[data-ea-publisher].loaded.dark .ea-content a:active,[data-ea-type].loaded.dark .ea-content a:active{color:#f6f6f6}[data-ea-publisher].loaded.dark .ea-content a strong,[data-ea-publisher].loaded.dark .ea-content a b,[data-ea-type].loaded.dark .ea-content a strong,[data-ea-type].loaded.dark .ea-content a b{color:#50baf9}[data-ea-publisher].loaded.dark .ea-callout a:link,[data-ea-type].loaded.dark .ea-callout a:link{color:#c3c3c3}[data-ea-publisher].loaded.dark .ea-callout a:visited,[data-ea-type].loaded.dark .ea-callout a:visited{color:#c3c3c3}[data-ea-publisher].loaded.dark .ea-callout a:hover,[data-ea-type].loaded.dark .ea-callout a:hover{color:#dcdcdc}[data-ea-publisher].loaded.dark .ea-callout a:active,[data-ea-type].loaded.dark .ea-callout a:active{color:#dcdcdc}[data-ea-publisher].loaded.dark .ea-callout a strong,[data-ea-publisher].loaded.dark .ea-callout a b,[data-ea-type].loaded.dark .ea-callout a strong,[data-ea-type].loaded.dark .ea-callout a b{color:#50baf9}@media (prefers-color-scheme: dark){[data-ea-publisher].loaded.adaptive .ea-content,[data-ea-type].loaded.adaptive .ea-content{background:rgba(255,255,255,0.05);color:#dcdcdc}[data-ea-publisher].loaded.adaptive .ea-content a:link,[data-ea-type].loaded.adaptive .ea-content a:link{color:#dcdcdc}[data-ea-publisher].loaded.adaptive .ea-content a:visited,[data-ea-type].loaded.adaptive .ea-content a:visited{color:#dcdcdc}[data-ea-publisher].loaded.adaptive .ea-content a:hover,[data-ea-type].loaded.adaptive .ea-content a:hover{color:#f6f6f6}[data-ea-publisher].loaded.adaptive .ea-content a:active,[data-ea-type].loaded.adaptive .ea-content a:active{color:#f6f6f6}[data-ea-publisher].loaded.adaptive .ea-content a strong,[data-ea-publisher].loaded.adaptive .ea-content a b,[data-ea-type].loaded.adaptive .ea-content a strong,[data-ea-type].loaded.adaptive .ea-content a b{color:#50baf9}[data-ea-publisher].loaded.adaptive .ea-callout a:link,[data-ea-type].loaded.adaptive .ea-callout a:link{color:#c3c3c3}[data-ea-publisher].loaded.adaptive .ea-callout a:visited,[data-ea-type].loaded.adaptive .ea-callout a:visited{color:#c3c3c3}[data-ea-publisher].loaded.adaptive .ea-callout a:hover,[data-ea-type].loaded.adaptive .ea-callout a:hover{color:#dcdcdc}[data-ea-publisher].loaded.adaptive .ea-callout a:active,[data-ea-type].loaded.adaptive .ea-callout a:active{color:#dcdcdc}[data-ea-publisher].loaded.adaptive .ea-callout a strong,[data-ea-publisher].loaded.adaptive .ea-callout a b,[data-ea-type].loaded.adaptive .ea-callout a strong,[data-ea-type].loaded.adaptive .ea-callout a b{color:#50baf9}}[data-ea-publisher].loaded .ea-content,[data-ea-type].loaded .ea-content{border:0px;border-radius:3px;box-shadow:0px 2px 3px rgba(0,0,0,0.15)}[data-ea-publisher].loaded.raised .ea-content,[data-ea-type].loaded.raised .ea-content{border:0px;border-radius:3px;box-shadow:0px 2px 3px rgba(0,0,0,0.15)}[data-ea-publisher].loaded.bordered .ea-content,[data-ea-type].loaded.bordered .ea-content{border:1px solid rgba(0,0,0,0.04);border-radius:3px;box-shadow:none}[data-ea-publisher].loaded.bordered.dark .ea-content,[data-ea-type].loaded.bordered.dark .ea-content{border:1px solid rgba(255,255,255,0.07)}@media (prefers-color-scheme: dark){[data-ea-publisher].loaded.bordered.adaptive .ea-content,[data-ea-type].loaded.bordered.adaptive .ea-content{border:1px solid rgba(255,255,255,0.07)}}[data-ea-publisher].loaded.flat .ea-content,[data-ea-type].loaded.flat .ea-content{border:0px;border-radius:3px;box-shadow:none}[data-ea-type="image"].loaded,[data-ea-publisher]:not([data-ea-type]).loaded,.ea-type-image{display:inline-block}[data-ea-type="image"].loaded .ea-content,[data-ea-publisher]:not([data-ea-type]).loaded .ea-content,.ea-type-image .ea-content{max-width:180px;overflow:auto;text-align:center}[data-ea-type="image"].loaded .ea-content>a>img,[data-ea-publisher]:not([data-ea-type]).loaded .ea-content>a>img,.ea-type-image .ea-content>a>img{width:120px;height:90px;display:inline-block}[data-ea-type="image"].loaded .ea-content>.ea-text,[data-ea-publisher]:not([data-ea-type]).loaded .ea-content>.ea-text,.ea-type-image .ea-content>.ea-text{margin-top:1em;font-size:1em;text-align:center}[data-ea-type="image"].loaded .ea-callout,[data-ea-publisher]:not([data-ea-type]).loaded .ea-callout,.ea-type-image .ea-callout{max-width:180px;margin:0em 1em 1em 1em;padding-left:1em;padding-right:1em;font-style:italic;text-align:right}[data-ea-type="image"].loaded.horizontal .ea-content,[data-ea-publisher]:not([data-ea-type]).loaded.horizontal .ea-content,.ea-type-image.horizontal .ea-content{max-width:320px}[data-ea-type="image"].loaded.horizontal .ea-content>a>img,[data-ea-publisher]:not([data-ea-type]).loaded.horizontal .ea-content>a>img,.ea-type-image.horizontal .ea-content>a>img{float:left;margin-right:1em}[data-ea-type="image"].loaded.horizontal .ea-content .ea-text,[data-ea-publisher]:not([data-ea-type]).loaded.horizontal .ea-content .ea-text,.ea-type-image.horizontal .ea-content .ea-text{margin-top:0em;text-align:left;overflow:auto}[data-ea-type="image"].loaded.horizontal .ea-callout,[data-ea-publisher]:not([data-ea-type]).loaded.horizontal .ea-callout,.ea-type-image.horizontal .ea-callout{max-width:320px;text-align:right}[data-ea-type="text"].loaded,.ea-type-text{font-size:14px}[data-ea-type="text"].loaded .ea-content,.ea-type-text .ea-content{text-align:left}[data-ea-type="text"].loaded .ea-callout,.ea-type-text .ea-callout{margin:0.5em 1em 1em 1em;padding-left:1em;padding-right:1em;text-align:right;font-style:italic}
</style><script src="./1. Week 01 - English Auction Plutus Pioneer Program_files/saved_resource" type="text/javascript" async=""></script></head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="https://plutus-pioneer-program.readthedocs.io/en/latest/index.html" class="icon icon-home"> Plutus Pioneer Program Lecture Notes
          

          
          </a>

          
            
            
            
              <div class="version">
                latest
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="https://plutus-pioneer-program.readthedocs.io/en/latest/search.html" method="get">
    <input type="text" name="q" placeholder="Search docs">
    <input type="hidden" name="check_keywords" value="yes">
    <input type="hidden" name="area" value="default">
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Plutus Pioneer Program</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal current" href="https://plutus-pioneer-program.readthedocs.io/en/latest/pioneer/week1.html#"><span class="toctree-expand"></span>1. Week 01 - English Auction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="https://plutus-pioneer-program.readthedocs.io/en/latest/pioneer/week1.html#welcome">1.1. Welcome</a></li>
<li class="toctree-l2"><a class="reference internal" href="https://plutus-pioneer-program.readthedocs.io/en/latest/pioneer/week1.html#the-e-utxo-model"><span class="toctree-expand"></span>1.2. The (E)UTxO Model</a><ul>
<li class="toctree-l3"><a class="reference internal" href="https://plutus-pioneer-program.readthedocs.io/en/latest/pioneer/week1.html#overview">1.2.1. Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="https://plutus-pioneer-program.readthedocs.io/en/latest/pioneer/week1.html#when-is-spending-allowed">1.2.2. When Is Spending Allowed?</a></li>
<li class="toctree-l3"><a class="reference internal" href="https://plutus-pioneer-program.readthedocs.io/en/latest/pioneer/week1.html#script-context"><span class="toctree-expand"></span>1.2.3. Script Context</a><ul>
<li class="toctree-l4"><a class="reference internal" href="https://plutus-pioneer-program.readthedocs.io/en/latest/pioneer/week1.html#the-bitcoin-approach">1.2.3.1. The Bitcoin approach</a></li>
<li class="toctree-l4"><a class="reference internal" href="https://plutus-pioneer-program.readthedocs.io/en/latest/pioneer/week1.html#the-ethereum-approach">1.2.3.2. The Ethereum approach</a></li>
<li class="toctree-l4"><a class="reference internal" href="https://plutus-pioneer-program.readthedocs.io/en/latest/pioneer/week1.html#the-cardano-approach">1.2.3.3. The Cardano approach</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="https://plutus-pioneer-program.readthedocs.io/en/latest/pioneer/week1.html#running-an-example-auction-contract-on-a-local-playground"><span class="toctree-expand"></span>1.3. Running an example auction contract on a local Playground</a><ul>
<li class="toctree-l3"><a class="reference internal" href="https://plutus-pioneer-program.readthedocs.io/en/latest/pioneer/week1.html#the-english-auction-contract"><span class="toctree-expand"></span>1.3.1. The English Auction contract</a><ul>
<li class="toctree-l4"><a class="reference internal" href="https://plutus-pioneer-program.readthedocs.io/en/latest/pioneer/week1.html#on-chain-and-off-chain-code">1.3.1.1. On-chain and Off-chain code</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="https://plutus-pioneer-program.readthedocs.io/en/latest/pioneer/week1.html#to-the-playground"><span class="toctree-expand"></span>1.4. To the Playground</a><ul>
<li class="toctree-l3"><a class="reference internal" href="https://plutus-pioneer-program.readthedocs.io/en/latest/pioneer/week1.html#plutus-setup"><span class="toctree-expand"></span>1.4.1. Plutus Setup</a><ul>
<li class="toctree-l4"><a class="reference internal" href="https://plutus-pioneer-program.readthedocs.io/en/latest/pioneer/week1.html#server">1.4.1.1. Server</a></li>
<li class="toctree-l4"><a class="reference internal" href="https://plutus-pioneer-program.readthedocs.io/en/latest/pioneer/week1.html#client">1.4.1.2. Client</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="https://plutus-pioneer-program.readthedocs.io/en/latest/pioneer/week2.html">2. Week 02 - Validation</a></li>
<li class="toctree-l1"><a class="reference internal" href="https://plutus-pioneer-program.readthedocs.io/en/latest/pioneer/week3.html">3. Week 03 - Script Context</a></li>
<li class="toctree-l1"><a class="reference internal" href="https://plutus-pioneer-program.readthedocs.io/en/latest/pioneer/week4.html">4. Week 04 - Monads</a></li>
<li class="toctree-l1"><a class="reference internal" href="https://plutus-pioneer-program.readthedocs.io/en/latest/pioneer/week5.html">5. Week 05 - Native Tokens</a></li>
<li class="toctree-l1"><a class="reference internal" href="https://plutus-pioneer-program.readthedocs.io/en/latest/pioneer/week6.html">6. Week 06 - Oracles</a></li>
<li class="toctree-l1"><a class="reference internal" href="https://plutus-pioneer-program.readthedocs.io/en/latest/pioneer/week7.html">7. Week 07 - State Machines</a></li>
<li class="toctree-l1"><a class="reference internal" href="https://plutus-pioneer-program.readthedocs.io/en/latest/pioneer/week8.html">8. Week 08 - Property Based Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="https://plutus-pioneer-program.readthedocs.io/en/latest/pioneer/week9.html">9. Week 09 - Marlowe</a></li>
<li class="toctree-l1"><a class="reference internal" href="https://plutus-pioneer-program.readthedocs.io/en/latest/pioneer/week10.html">10. Week 10 - Uniswap</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Alonzo Testnet Exercises</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="https://plutus-pioneer-program.readthedocs.io/en/latest/alonzo/aws_node_setup.html">1. AWS Node Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="https://plutus-pioneer-program.readthedocs.io/en/latest/alonzo/wallets_and_funds.html">2. Wallets and Funds</a></li>
<li class="toctree-l1"><a class="reference internal" href="https://plutus-pioneer-program.readthedocs.io/en/latest/alonzo/always_succeeds_script.html">3. AlwaysSucceeds Script</a></li>
<li class="toctree-l1"><a class="reference internal" href="https://plutus-pioneer-program.readthedocs.io/en/latest/alonzo/always_fails_script.html">4. AlwaysFails Script</a></li>
<li class="toctree-l1"><a class="reference internal" href="https://plutus-pioneer-program.readthedocs.io/en/latest/alonzo/hello_world_script.html">5. HelloWorld Script</a></li>
<li class="toctree-l1"><a class="reference internal" href="https://plutus-pioneer-program.readthedocs.io/en/latest/alonzo/hello_world_person.html">6. HelloWorld, ByteStrings and Redeemer</a></li>
<li class="toctree-l1"><a class="reference internal" href="https://plutus-pioneer-program.readthedocs.io/en/latest/alonzo/minting_tokens.html">1. Minting Tokens</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Node Administration</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="https://plutus-pioneer-program.readthedocs.io/en/latest/admin/aws_node_setup.html">1. Install the Cardano node</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="https://plutus-pioneer-program.readthedocs.io/en/latest/index.html">Plutus Pioneer Program Lecture Notes</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="https://plutus-pioneer-program.readthedocs.io/en/latest/index.html" class="icon icon-home"></a> »</li>
        
      <li><span class="section-number">1. </span>Week 01 - English Auction</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            
              <a href="https://github.com/chris-moreton/plutus-pioneer-program/blob/main/docs/pioneer/week1.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="week-01-english-auction">
<h1><span class="section-number">1. </span>Week 01 - English Auction<a class="headerlink" href="https://plutus-pioneer-program.readthedocs.io/en/latest/pioneer/week1.html#week-01-english-auction" title="Permalink to this headline">¶</a></h1>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This is a written version of <a class="reference external" href="https://www.youtube.com/watch?v=_zr3W8cgzIQ&amp;t=2394s">Lecture
#1 - Iteration #2</a>.</p>
<p>It covers an introduction to Plutus, the (E)UTxO model (and how it
compares to other models), and concludes with an example English Auction
managed with a Plutus smart contract running on the Plutus Playground.</p>
<p>These notes have been updated to reflect the changes in iteration two of the
program.</p>
<p>The Plutus commit used in these notes is ea0ca4e9f9821a9dbfc5255fa0f42b6f2b3887c4.</p>
</div>
<div class="section" id="welcome">
<h2><span class="section-number">1.1. </span>Welcome<a class="headerlink" href="https://plutus-pioneer-program.readthedocs.io/en/latest/pioneer/week1.html#welcome" title="Permalink to this headline">¶</a></h2>
<p>Learning Plutus isn’t easy, and there are a number of reasons for that.</p>
<ol class="arabic simple">
<li><p>Plutus uses the (E)UTxO model. This is different and less intuitive
than the Ethereum method for creating smart contracts. It has a lot
of advantages, but it requires a new way of thinking about smart
contracts. And that’s before we even start with the language itself.</p></li>
<li><p>Plutus is new and still under rapid development.</p></li>
<li><p>Tooling is not ideal, yet. So, experienced Haskell developers will
notice that the experience with Plutus is not as pleasant, for
example, when trying to access documentation or get syntax hints from
the REPL. It can also be a challenge to build Plutus in the first
place. The easiest way currently is to use Nix. The Plutus team is
working on providing a Docker image, which will help.</p></li>
<li><p>Plutus is Haskell, more or less, which can have a tough learning
curve for those coming from an imperative programming background.</p></li>
<li><p>Plutus is brand new and this means that there are not many help
resources available, such as StackOverflow posts.</p></li>
</ol>
</div>
<div class="section" id="the-e-utxo-model">
<h2><span class="section-number">1.2. </span>The (E)UTxO Model<a class="headerlink" href="https://plutus-pioneer-program.readthedocs.io/en/latest/pioneer/week1.html#the-e-utxo-model" title="Permalink to this headline">¶</a></h2>
<div class="section" id="overview">
<h3><span class="section-number">1.2.1. </span>Overview<a class="headerlink" href="https://plutus-pioneer-program.readthedocs.io/en/latest/pioneer/week1.html#overview" title="Permalink to this headline">¶</a></h3>
<p>One of the most important things you need to understand in order to
write Plutus smart contracts is the accounting model that Cardano uses,
the Extended Unspent Transaction Output model.</p>
<p>The UTxO model, without the (E) is the one that was introduced by
Bitcoin, but there are other models. Ethereum for example, uses the
so-called account-based model, which is what you are used to from normal
banking, where everybody has an account, each account has a balance
and if you transfer money from one account to another then the balances
get updated accordingly.</p>
<p>That is not how the UTxO model works.</p>
<p>Unspent transaction outputs are exactly what the name says. They are
transaction outputs from previous transactions that have happened on the
blockchain that have not yet been spent.</p>
<p>Let’s look at an example where we have two such UTxOs. One belonging to Alice of 100 Ada, and another belonging to Bob of 50 Ada.</p>
<div class="figure align-default">
<img alt="Alice and Bob&#39;s UTxOs" src="./1. Week 01 - English Auction Plutus Pioneer Program_files/pic__00000.png">
</div>
<p>Alice wants to send 10 ADA to Bob, so she needs to create a transaction.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>A transaction is something that contains an arbitrary number of inputs and
an arbitrary number of outputs. The effect of a transaction is to consume
inputs and produce new outputs.</p>
</div>
<p>The important thing is that you can only ever use complete UTxOs as
input. Alice cannot simply split her existing 100 ADA into a 90 and a
10, she has to use the full 100 ADA as the input to a transaction.</p>
<div class="figure align-default">
<img alt="Alice Creates a Transaction" src="./1. Week 01 - English Auction Plutus Pioneer Program_files/2.png">
</div>
<p>Once consumed by the transaction, Alice’s input is no longer a UTxO (an unspent transaction). It will
have been spent as an input to Tx 1. So, she needs to create outputs for her transaction.</p>
<p>She wants to pay 10 ADA to Bob, so one output will be 10 ADA (to Bob).
She then wants her change back, so she creates a second output of 90
ADA (to herself). The full UTxO of 100 ADA has been spent, with Bob
receiving a new transaction of 10 ADA, and Alice receiving the change
of 90 ADA.</p>
<div class="figure align-default">
<img alt="Alice&#39;s Transaction Generates Two New UTxOs" src="./1. Week 01 - English Auction Plutus Pioneer Program_files/3.png">
</div>
<p>In any transaction, the sum of the output values must match the sum of
the input values. Although, strictly speaking, this is not true. There
are two exceptions.</p>
<ol class="arabic simple">
<li><p>Transaction fees. In a real blockchain, you have to pay fees for each
transactions.</p></li>
<li><p>Native Tokens. It’s possible for transactions to create new tokens,
or to burn tokens, in which case the inputs will be lower or higher
than the outputs, depending on the scenario.</p></li>
</ol>
<p>Let’s take a look at a slightly more complicated example.</p>
<p>Alice and Bob want to transfer 55 ADA each to Charlie. Alice has no
choice, as she only has one UTxO. Bob also has no choice as neither of
his two UTxOs is large enough to cover the 55 ADA he wishes to send to
Charlie. Bob will have to use both his UTxOs as input.</p>
<div class="figure align-default">
<img alt="Alice and Bob Create a Transaction With Three Outputs" src="./1. Week 01 - English Auction Plutus Pioneer Program_files/4.png">
</div>
</div>
<div class="section" id="when-is-spending-allowed">
<h3><span class="section-number">1.2.2. </span>When Is Spending Allowed?<a class="headerlink" href="https://plutus-pioneer-program.readthedocs.io/en/latest/pioneer/week1.html#when-is-spending-allowed" title="Permalink to this headline">¶</a></h3>
<p>Obviously it wouldn’t be a good idea if any transaction could spend
arbitrary UTxOs. If that was the case then Bob could spend Alice’s money
without her consent.</p>
<p>The way it works is by adding signatures to transactions.</p>
<p>In transaction 1, Alice’s signature has to be added to the transaction.
In transaction 2, both Alice and Bob need to sign the transaction. Incidentally, this second, more complex, transaction cannot be done in Daedalus, so you would need
to use the CLI for this.</p>
<p>Everything explained so far is just about the UTxO model, not the
(E)UTxO model.</p>
<p>The extended part comes in when we talk about smart contracts, so in
order to understand that, let’s concentrate on the consumption of
Alice’s UTxO of 100 ADA.</p>
<div class="figure align-default">
<img alt="Alice&#39;s UTxO as an Input (Blue Line)" src="./1. Week 01 - English Auction Plutus Pioneer Program_files/5.png">
</div>
<p>In the UTxO model, the validation that decides whether the transaction
that this input belongs to is allowed to consume the UTxO, relies on
digital signatures. In this case, that means that Alice has to sign the
transaction in order for the consumption of the UTxO to be valid.</p>
<p>The idea of the (E)UTxO model is to make this more general.</p>
<p>Instead of having just one condition, namely that the appropriate
signature is present in the transaction, we replace this with arbitrary
logic.</p>
<p>This is where Plutus comes in.</p>
<p>Instead of just having an address that corresponds to a public key that
can be verified by a signature that is added to the transaction, we have
more general addresses, not based on public keys or the hashes of public
keys, but instead contain arbitrary logic which decides under which conditions a
particular UTxO can be spent by a particular transaction.</p>
<p>So, instead of an input being validated simply by its public key, the input will
justify that it is allowed to consume this output with some arbitrary piece of data
that we call the <em>Redeemer</em>.</p>
<div class="figure align-default">
<img alt="The Redeemer Is Used To Validate Spending of the UTxO" src="./1. Week 01 - English Auction Plutus Pioneer Program_files/6.png">
</div>
<p>We replace the public key address (Alice’s in our example), with a script, and we replace the digital signature with a <em>Redeemer</em>.</p>
<p>What exactly does that mean? What do we mean by <em>arbitrary logic</em>?</p>
<p>It is important to consider the context that the script has. There are several options.</p>
</div>
<div class="section" id="script-context">
<h3><span class="section-number">1.2.3. </span>Script Context<a class="headerlink" href="https://plutus-pioneer-program.readthedocs.io/en/latest/pioneer/week1.html#script-context" title="Permalink to this headline">¶</a></h3>
<div class="section" id="the-bitcoin-approach">
<h4><span class="section-number">1.2.3.1. </span>The Bitcoin approach<a class="headerlink" href="https://plutus-pioneer-program.readthedocs.io/en/latest/pioneer/week1.html#the-bitcoin-approach" title="Permalink to this headline">¶</a></h4>
<p>One option is that all the script sees is the Redeemer. In this case,
the Redeemer contains all the logic necessary to verify the transaction.
This is, incidentally, what Bitcoin does. In Bitcoin, there are smart
contracts, but they are just not very smart. They are called Bitcoin
Script, which works exactly like this. There is a script on the UTxO
side and a redeemer on the input side, and the script gets the redeemer
and uses it to determine if it is ok to consume the UTxO or not.</p>
<p>But this is not the only option. We can decide to give more information
to the script.</p>
</div>
<div class="section" id="the-ethereum-approach">
<h4><span class="section-number">1.2.3.2. </span>The Ethereum approach<a class="headerlink" href="https://plutus-pioneer-program.readthedocs.io/en/latest/pioneer/week1.html#the-ethereum-approach" title="Permalink to this headline">¶</a></h4>
<p>Ethereum uses a different concept. In Ethereum, the script can see
everything - the whole blockchain - the opposite extreme of Bitcoin. In
Bitcoin, the script has very little context, all it can see is the
redeemer. In Ethereum, the Solidity scripts can see the complete state
of the blockchain.</p>
<p>This makes Ethereum scripts more powerful, but it also comes with
problems. Because the scripts are so powerful it is difficult to predict
what a given script will do and that opens the door to all sorts of
security issues and dangers. It is very hard for the developers of an
Ethereum smart contract to predict everything that can happen.</p>
</div>
<div class="section" id="the-cardano-approach">
<h4><span class="section-number">1.2.3.3. </span>The Cardano approach<a class="headerlink" href="https://plutus-pioneer-program.readthedocs.io/en/latest/pioneer/week1.html#the-cardano-approach" title="Permalink to this headline">¶</a></h4>
<p>What Cardano does is something in the middle.</p>
<p>In Plutus, the script cannot see the whole blockchain, but it can see
the whole transaction that is being validated. In contrast to Bitcoin,
it can’t see only the redeemer of the one input, but it can also see all
the inputs and outputs of the transaction, and the transaction itself.
The Plutus script can use this information to decide whether it is ok to
consume the output.</p>
<p>There is one last ingredient that Plutus scripts need in order to be as
powerful and expressive as Ethereum scripts. That is the so-called
Datum. That is a piece of data that can be associated with a UTxO along
with the UTxO value.</p>
<div class="figure align-default">
<img alt="Datum" src="./1. Week 01 - English Auction Plutus Pioneer Program_files/7.png">
</div>
<p>With this it is possible to prove mathematically that Plutus is at least
as powerful as the Ethereum model - any logic you can express in
Ethereum you can also it can express using the (E)UTxO model.</p>
<p>But it also has a lot of advantages compared to the Ethereum model. For
example, in Plutus, it is possible to check whether a transaction will
validate in your wallet, before you ever send it to the chain.</p>
<p>Things can still go wrong with off-chain validation, however. For
example in the situation where you submit a transaction that has been
validated in the wallet but gets rejected when it attempts to consume an
output on-chain that has already been consumed by another transaction.</p>
<p>In this case, your transaction will fail without you having to pay any
fees.</p>
<p>But if all the inputs are still there that your transaction expects,
then you can be sure that the transaction will validate and will have
the predicted effect.</p>
<p>This is not the case with Ethereum. In Ethereum, the time between you
constructing a transaction and it being incorporated into the
blockchain, a lot of stuff can happen concurrently, and that is
unpredictable and can have unpredictable effects on what will happen
when your script finally executes.</p>
<p>In Ethereum it is always possible that you have to pay gas fees for a
transaction even if the transaction eventually fails with an error. And
that is guaranteed to never happen with Cardano.</p>
<p>In addition to that, it is also easier to analyse a Plutus script and to
check, or even prove, that it is secure, because you don’t have to
consider the whole state of the blockchain, which is unknowable. You can
concentrate on this context that just consists of the spending
transaction. So you have a much more limited scope and that makes it
much easier to understand what a script is actually doing and what can
possibly go wrong.</p>
<p>Who is responsible for providing the datum, redeemer and the validator? The rule in Plutus is that the spending transaction has to do that whereas the producing transaction only has to provide hashes.</p>
<p>That means that if I produce an output that sits at a script address then this producing transaction only has to include the hash of the script
and the hash of the datum that belongs to the output. Optionally it can include the datum and the script as well.</p>
<p>If a transaction wants to consume such an output then <em>that</em> transaction has to provide the datum, the redeemer and the script. Which means that in order to spend a
given input, you need to know the datum, because only the hash is publicly visible on the blockchain.</p>
<p>This is sometimes a problem and not what you want and that’s why you have the option to include the datum in the producing transaction. If this were not possible, only
people that knew the datum by some means other than looking at the blockchain would ever be able to spend such an output.</p>
<p>The (E)UTxO model is not tied to a particular programming language. What
we have is Plutus, which is Haskell, but in principal you could use the
same model with a completely different programming language, and we
intend to write compilers for other programming languages to Plutus
Script which is the “assembly” language underlying Plutus.</p>
</div>
</div>
</div>
<div class="section" id="running-an-example-auction-contract-on-a-local-playground">
<h2><span class="section-number">1.3. </span>Running an example auction contract on a local Playground<a class="headerlink" href="https://plutus-pioneer-program.readthedocs.io/en/latest/pioneer/week1.html#running-an-example-auction-contract-on-a-local-playground" title="Permalink to this headline">¶</a></h2>
<p>Rather than start the traditional way, i.e. starting very simple and
doing a crash course on Haskell, followed by some simple Plutus
contracts and slowly add more complicated stuff, it will be more
interesting, especially for the first lecture, to showcase a more
interesting contract and demonstrate what Plutus can do. We can then use
that to look at certain concepts in more detail.</p>
<div class="section" id="the-english-auction-contract">
<h3><span class="section-number">1.3.1. </span>The English Auction contract<a class="headerlink" href="https://plutus-pioneer-program.readthedocs.io/en/latest/pioneer/week1.html#the-english-auction-contract" title="Permalink to this headline">¶</a></h3>
<p>As our introductory example we are going to look at an English Auction. Somebody wants to auction an NFT (Non-fungible token) - a native token on Cardano that
exists only once. An NFT can represent some digital art or maybe some real-world asset.</p>
<p>The auction is parameterised by the owner of the token, the token itself, a minimal bid and a deadline.</p>
<p>So let’s say that Alice has an NFT and wants to auction it.</p>
<div class="figure align-default">
<img alt="Alice Creates an English Auction" src="./1. Week 01 - English Auction Plutus Pioneer Program_files/pic__000001.png">
</div>
<p>She creates a UTxO at the script output. We will look at the code later, but first we will just examine the ideas of the UTxO model.</p>
<p>The value of the UTxO is the NFT, and the datum is <em>Nothing</em>. Later on it will be the highest bidder and the highest bid. But right now, there hasn’t yet been a bid.</p>
<p>In the real blockchain you can’t have a UTxO that just contains native tokens, they always have to be accompanied by some Ada, but for simplicity we will ignore that here.</p>
<p>Not let’s say that Bob wants to bid 100 Ada.</p>
<div class="figure align-default">
<img alt="Bob Makes a Bid" src="./1. Week 01 - English Auction Plutus Pioneer Program_files/pic__00001.png">
</div>
<p>In order to do this, Bob creates a transaction with two inputs and one output. The first input is the auction UTxO and the second input is Bob’s bid of 100 Ada. The output
is, again, at the output script, but now the value and the datum has changed. Previously the datum was <em>Nothing</em> but now it is (Bob, 100).</p>
<p>The value has changed because now there is not only the NFT in the UTxO, but also the 100 Ada bid.</p>
<p>As a redeemer, in order to unlock the original auction UTxO, we use something called <em>Bid</em>. This is just an algebraic data type. There will be other values as well but one
of those is <em>Bid</em>. And the auction script will check that all the conditions are satisfied. So, in this case the script has to check that the bid happens before the deadline,
that the bid is high enough.</p>
<p>It also has to check that the correct inputs and outputs are present. In this case that means checking that the auction is an output containing the NFT and has the correct datum.</p>
<p>Next, let’s assume that Charlie wants to outbid Bob and bid 200 Ada.</p>
<div class="figure align-default">
<img alt="Charlie Makes a Bid" src="./1. Week 01 - English Auction Plutus Pioneer Program_files/pic__00002.png">
</div>
<p>Charlie will create another transaction, this time one with two inputs and two outputs. As in the first case, the two inputs are the bid (this time Charlie’s bid of 200 Ada),
and the auction UTxO. One of the outputs is the updated auction UTxO. There will also be a second output, which will be a UTxO which returns Bob’s bid of 100 Ada.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In reality the auction UTxO is not updated because nothing ever changes.</p>
<p>What really happens is that the old auction UTxO is spent and a new one is created, but it has the feel of updating the state of the auction UTxO</p>
</div>
<p>This time we again use the <em>Bid</em> redeemer. This time the script has to check that the deadline has been reached, that the bid is higher than the previous bid, it has to
check that the auction UTxO is correctly created and it has to check that the previous highest bidder gets their bid back.</p>
<p>Finally, let’s assume that there won’t be another bid, so once the deadline has been reached, the auction can be closed.</p>
<p>In order to do that, somebody has to create yet another transaction. That could be Alice who wants to collect the bid or it could be Charlie who wants to collect the NFT. It
can be anybody, but Alice and Charlie have an incentive to do so.</p>
<p>This transaction will have one input - the auction UTxO, this time with the <em>Close</em> redeemer - and it will have two outputs. One of the outputs is for highest bidder,
Charlie, and he gets the NFT and the second output goes to Alice who gets the highest bid.</p>
<p>In the <em>Close</em> case, the script has to check that the deadline has been reached and that the winner gets the NFT and the auction owner gets the highest bid.</p>
<p>There is one more scenario for us to consider, namely that nobody makes any bid.</p>
<div class="figure align-default">
<img alt="Nobody Makes a Bid" src="./1. Week 01 - English Auction Plutus Pioneer Program_files/pic__00002.png">
</div>
<p>Alice creates the auction, but receives no bids. In this case, there must be a mechanism for Alice to retrieve her NFT.</p>
<p>For that she creates a transaction with the <em>Close</em> redeemer, but now because there is no bidder, the NFT doesn’t go to the highest bidder but simply goes back to Alice.</p>
<p>The logic in this case is slightly different. It will check that the NFT goes back to Alice, however, it doesn’t really need to check the recipient because the transaction
will be triggered by Alice and she can send the NFT wherever she wants.</p>
<div class="section" id="on-chain-and-off-chain-code">
<h4><span class="section-number">1.3.1.1. </span>On-chain and Off-chain code<a class="headerlink" href="https://plutus-pioneer-program.readthedocs.io/en/latest/pioneer/week1.html#on-chain-and-off-chain-code" title="Permalink to this headline">¶</a></h4>
<p>The important thing to realise about Plutus is that there is on-chain and off-chain code.</p>
<div class="section" id="on-chain">
<h5><span class="section-number">1.3.1.1.1. </span>On-chain<a class="headerlink" href="https://plutus-pioneer-program.readthedocs.io/en/latest/pioneer/week1.html#on-chain" title="Permalink to this headline">¶</a></h5>
<p>On-chain code is the scripts we were discussing - the scripts from the UTxO model. In addition to public key addresses we have script address and outputs can sit at
such an address, and if a transaction tries to consume such an output, the script is executed, and the transaction is only valid if the script succeeds.</p>
<p>If a node receives a new transaction, it validates it before accepting it into its mempool and eventually into a block. For each input of the transaction, if that input
happens to be a script address, the corresponding script is executed. If the script does not succeed, the transaction is invalid.</p>
<p>The programming language this script is expressed in is called Plutus Core, but you never write Plutus Core by hand. Instead, you write Haskell and that gets compiled
down to Plutus Core. EVentually there may be other high-level languages such as Solidity, C or Python that can compile down to Plutus Core.</p>
<p>The task of a script is to say yes or no to whether a transaction can consume an output.</p>
</div>
<div class="section" id="off-chain">
<h5><span class="section-number">1.3.1.1.2. </span>Off-chain<a class="headerlink" href="https://plutus-pioneer-program.readthedocs.io/en/latest/pioneer/week1.html#off-chain" title="Permalink to this headline">¶</a></h5>
<p>In order to unlock a UTxO, you must be able to construct a transaction that will pass validation and that is the responsibility of the off-chain part of Plutus. This
is the part that runs on the wallet and not on the blockchain and will construct suitable transactions.</p>
<p>One of the nice things about Plutus is that both the on-chain parts and the off-chain parts are written in Haskell. One obvious advantage of that is that you don’t
have to learn two programming languages. The other advantage is that you can share code between the on-chain and off-chain parts.</p>
<p>Later in this course we talk about state machines and then this sharing between on-chain and off-chain code becomes even more direct, but even without state machines
there is still a lot of opportunities to share code.</p>
<p>We will have a brief look at the code but don’t worry, you are not expected to understand it at this point.</p>
<p>The code for the English Auction contract is at</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">plutus</span><span class="o">-</span><span class="n">pioneer</span><span class="o">-</span><span class="n">program</span><span class="o">/</span><span class="n">repo</span><span class="o">/</span><span class="n">code</span><span class="o">/</span><span class="n">week01</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">Week01</span><span class="o">/</span><span class="n">EnglishAuction</span><span class="o">.</span><span class="n">hs</span>
</pre></div>
</div>
<p>We see a data type <em>Auction</em> which represents the parameters for the contract that, in our example, Alice starts. The <em>aCurrency</em> and <em>aToken</em> parameters represent the
NFT.</p>
<div class="highlight-haskell notranslate"><div class="highlight"><pre><span></span><span class="kr">data</span> <span class="kt">Auction</span> <span class="ow">=</span> <span class="kt">Auction</span>
   <span class="p">{</span> <span class="n">aSeller</span>   <span class="ow">::</span> <span class="o">!</span><span class="kt">PubKeyHash</span>
   <span class="p">,</span> <span class="n">aDeadline</span> <span class="ow">::</span> <span class="o">!</span><span class="kt">POSIXTime</span>
   <span class="p">,</span> <span class="n">aMinBid</span>   <span class="ow">::</span> <span class="o">!</span><span class="kt">Integer</span>
   <span class="p">,</span> <span class="n">aCurrency</span> <span class="ow">::</span> <span class="o">!</span><span class="kt">CurrencySymbol</span>
   <span class="p">,</span> <span class="n">aToken</span>    <span class="ow">::</span> <span class="o">!</span><span class="kt">TokenName</span>
   <span class="p">}</span> <span class="kr">deriving</span> <span class="p">(</span><span class="kt">Show</span><span class="p">,</span> <span class="kt">Generic</span><span class="p">,</span> <span class="kt">ToJSON</span><span class="p">,</span> <span class="kt">FromJSON</span><span class="p">,</span> <span class="kt">ToSchema</span><span class="p">)</span>
</pre></div>
</div>
<p>You also see other data types, but the heart of the code is the <em>mkAuctionValidator</em> function. This is the function that determines whether a given transaction is allowed
to spend a UTxO sitting at this script address.</p>
<div class="highlight-haskell notranslate"><div class="highlight"><pre><span></span><span class="cm">{-# INLINABLE mkAuctionValidator #-}</span>
<span class="nf">mkAuctionValidator</span> <span class="ow">::</span> <span class="kt">AuctionDatum</span> <span class="ow">-&gt;</span> <span class="kt">AuctionAction</span> <span class="ow">-&gt;</span> <span class="kt">ScriptContext</span> <span class="ow">-&gt;</span> <span class="kt">Bool</span>
<span class="nf">mkAuctionValidator</span> <span class="n">ad</span> <span class="n">redeemer</span> <span class="n">ctx</span> <span class="ow">=</span>
    <span class="n">traceIfFalse</span> <span class="s">"wrong input value"</span> <span class="n">correctInputValue</span> <span class="o">&amp;&amp;</span>
    <span class="kr">case</span> <span class="n">redeemer</span> <span class="kr">of</span>
        <span class="kt">MkBid</span> <span class="n">b</span><span class="o">@</span><span class="kt">Bid</span><span class="p">{</span><span class="o">..</span><span class="p">}</span> <span class="ow">-&gt;</span>
            <span class="n">traceIfFalse</span> <span class="s">"bid too low"</span> <span class="p">(</span><span class="n">sufficientBid</span> <span class="n">bBid</span><span class="p">)</span>                <span class="o">&amp;&amp;</span>
            <span class="n">traceIfFalse</span> <span class="s">"wrong output datum"</span> <span class="p">(</span><span class="n">correctBidOutputDatum</span> <span class="n">b</span><span class="p">)</span>    <span class="o">&amp;&amp;</span>
            <span class="n">traceIfFalse</span> <span class="s">"wrong output value"</span> <span class="p">(</span><span class="n">correctBidOutputValue</span> <span class="n">bBid</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
            <span class="n">traceIfFalse</span> <span class="s">"wrong refund"</span>       <span class="n">correctBidRefund</span>             <span class="o">&amp;&amp;</span>
            <span class="n">traceIfFalse</span> <span class="s">"too late"</span>           <span class="n">correctBidSlotRange</span>
        <span class="kt">Close</span>           <span class="ow">-&gt;</span>
            <span class="n">traceIfFalse</span> <span class="s">"too early"</span> <span class="n">correctCloseSlotRange</span> <span class="o">&amp;&amp;</span>
            <span class="kr">case</span> <span class="n">adHighestBid</span> <span class="n">ad</span> <span class="kr">of</span>
                <span class="kt">Nothing</span>      <span class="ow">-&gt;</span>
                    <span class="n">traceIfFalse</span> <span class="s">"expected seller to get token"</span> <span class="p">(</span><span class="n">getsValue</span> <span class="p">(</span><span class="n">aSeller</span> <span class="n">auction</span><span class="p">)</span> <span class="n">tokenValue</span><span class="p">)</span>
                <span class="kt">Just</span> <span class="kt">Bid</span><span class="p">{</span><span class="o">..</span><span class="p">}</span> <span class="ow">-&gt;</span>
                    <span class="n">traceIfFalse</span> <span class="s">"expected highest bidder to get token"</span> <span class="p">(</span><span class="n">getsValue</span> <span class="n">bBidder</span> <span class="n">tokenValue</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
                    <span class="n">traceIfFalse</span> <span class="s">"expected seller to get highest bid"</span> <span class="p">(</span><span class="n">getsValue</span> <span class="p">(</span><span class="n">aSeller</span> <span class="n">auction</span><span class="p">)</span> <span class="o">$</span> <span class="kt">Ada</span><span class="o">.</span><span class="n">lovelaceValueOf</span> <span class="n">bBid</span><span class="p">)</span>

  <span class="kr">where</span>
      <span class="o">...</span>
</pre></div>
</div>
<p>And then here is where the compilation to Plutus Core happens. It uses something called Template Haskell to take the Haskell function above and compile it to Plutus Core.</p>
<div class="highlight-haskell notranslate"><div class="highlight"><pre><span></span><span class="nf">auctionTypedValidator</span> <span class="ow">::</span> <span class="kt">Scripts</span><span class="o">.</span><span class="kt">TypedValidator</span> <span class="kt">Auctioning</span>
<span class="nf">auctionTypedValidator</span> <span class="ow">=</span> <span class="kt">Scripts</span><span class="o">.</span><span class="n">mkTypedValidator</span> <span class="o">@</span><span class="kt">Auctioning</span>
    <span class="o">$$</span><span class="p">(</span><span class="kt">PlutusTx</span><span class="o">.</span><span class="n">compile</span> <span class="p">[</span><span class="o">||</span> <span class="n">mkAuctionValidator</span> <span class="o">||</span><span class="p">])</span>
    <span class="o">$$</span><span class="p">(</span><span class="kt">PlutusTx</span><span class="o">.</span><span class="n">compile</span> <span class="p">[</span><span class="o">||</span> <span class="n">wrap</span> <span class="o">||</span><span class="p">])</span>
  <span class="kr">where</span>
    <span class="n">wrap</span> <span class="ow">=</span> <span class="kt">Scripts</span><span class="o">.</span><span class="n">wrapValidator</span>
</pre></div>
</div>
<p>The off-chain part of the code defines the endpoints that can be invoked.</p>
<p>We have three endpoints for this example, and each has a datatype defined to represent their parameters.</p>
<div class="highlight-haskell notranslate"><div class="highlight"><pre><span></span><span class="kr">data</span> <span class="kt">StartParams</span> <span class="ow">=</span> <span class="kt">StartParams</span>
   <span class="p">{</span> <span class="n">spDeadline</span> <span class="ow">::</span> <span class="o">!</span><span class="kt">POSIXTime</span>
   <span class="p">,</span> <span class="n">spMinBid</span>   <span class="ow">::</span> <span class="o">!</span><span class="kt">Integer</span>
   <span class="p">,</span> <span class="n">spCurrency</span> <span class="ow">::</span> <span class="o">!</span><span class="kt">CurrencySymbol</span>
   <span class="p">,</span> <span class="n">spToken</span>    <span class="ow">::</span> <span class="o">!</span><span class="kt">TokenName</span>
   <span class="p">}</span> <span class="kr">deriving</span> <span class="p">(</span><span class="kt">Generic</span><span class="p">,</span> <span class="kt">ToJSON</span><span class="p">,</span> <span class="kt">FromJSON</span><span class="p">,</span> <span class="kt">ToSchema</span><span class="p">)</span>

<span class="kr">data</span> <span class="kt">BidParams</span> <span class="ow">=</span> <span class="kt">BidParams</span>
   <span class="p">{</span> <span class="n">bpCurrency</span> <span class="ow">::</span> <span class="o">!</span><span class="kt">CurrencySymbol</span>
   <span class="p">,</span> <span class="n">bpToken</span>    <span class="ow">::</span> <span class="o">!</span><span class="kt">TokenName</span>
   <span class="p">,</span> <span class="n">bpBid</span>      <span class="ow">::</span> <span class="o">!</span><span class="kt">Integer</span>
   <span class="p">}</span> <span class="kr">deriving</span> <span class="p">(</span><span class="kt">Generic</span><span class="p">,</span> <span class="kt">ToJSON</span><span class="p">,</span> <span class="kt">FromJSON</span><span class="p">,</span> <span class="kt">ToSchema</span><span class="p">)</span>

<span class="kr">data</span> <span class="kt">CloseParams</span> <span class="ow">=</span> <span class="kt">CloseParams</span>
   <span class="p">{</span> <span class="n">cpCurrency</span> <span class="ow">::</span> <span class="o">!</span><span class="kt">CurrencySymbol</span>
   <span class="p">,</span> <span class="n">cpToken</span>    <span class="ow">::</span> <span class="o">!</span><span class="kt">TokenName</span>
   <span class="p">}</span> <span class="kr">deriving</span> <span class="p">(</span><span class="kt">Generic</span><span class="p">,</span> <span class="kt">ToJSON</span><span class="p">,</span> <span class="kt">FromJSON</span><span class="p">,</span> <span class="kt">ToSchema</span><span class="p">)</span>
</pre></div>
</div>
<p>Then the off-chain operations are defined.</p>
<p>First the <em>start</em> logic.</p>
<div class="highlight-haskell notranslate"><div class="highlight"><pre><span></span><span class="nf">start</span> <span class="ow">::</span> <span class="kt">AsContractError</span> <span class="n">e</span> <span class="ow">=&gt;</span> <span class="kt">StartParams</span> <span class="ow">-&gt;</span> <span class="kt">Contract</span> <span class="n">w</span> <span class="n">s</span> <span class="n">e</span> <span class="nb">()</span>
<span class="nf">start</span> <span class="kt">StartParams</span><span class="p">{</span><span class="o">..</span><span class="p">}</span> <span class="ow">=</span> <span class="kr">do</span>
    <span class="n">pkh</span> <span class="ow">&lt;-</span> <span class="n">pubKeyHash</span> <span class="o">&lt;$&gt;</span> <span class="n">ownPubKey</span>
    <span class="kr">let</span> <span class="n">a</span> <span class="ow">=</span> <span class="kt">Auction</span>
                <span class="p">{</span> <span class="n">aSeller</span>   <span class="ow">=</span> <span class="n">pkh</span>
                <span class="p">,</span> <span class="n">aDeadline</span> <span class="ow">=</span> <span class="n">spDeadline</span>
                <span class="p">,</span> <span class="n">aMinBid</span>   <span class="ow">=</span> <span class="n">spMinBid</span>
                <span class="p">,</span> <span class="n">aCurrency</span> <span class="ow">=</span> <span class="n">spCurrency</span>
                <span class="p">,</span> <span class="n">aToken</span>    <span class="ow">=</span> <span class="n">spToken</span>
                <span class="p">}</span>
        <span class="n">d</span> <span class="ow">=</span> <span class="kt">AuctionDatum</span>
                <span class="p">{</span> <span class="n">adAuction</span>    <span class="ow">=</span> <span class="n">a</span>
                <span class="p">,</span> <span class="n">adHighestBid</span> <span class="ow">=</span> <span class="kt">Nothing</span>
                <span class="p">}</span>
        <span class="n">v</span> <span class="ow">=</span> <span class="kt">Value</span><span class="o">.</span><span class="n">singleton</span> <span class="n">spCurrency</span> <span class="n">spToken</span> <span class="mi">1</span>
        <span class="n">tx</span> <span class="ow">=</span> <span class="n">mustPayToTheScript</span> <span class="n">d</span> <span class="n">v</span>
    <span class="n">ledgerTx</span> <span class="ow">&lt;-</span> <span class="n">submitTxConstraints</span> <span class="n">auctionTypedValidator</span> <span class="n">tx</span>
    <span class="n">void</span> <span class="o">$</span> <span class="n">awaitTxConfirmed</span> <span class="o">$</span> <span class="n">txId</span> <span class="n">ledgerTx</span>
    <span class="n">logInfo</span> <span class="o">@</span><span class="kt">String</span> <span class="o">$</span> <span class="n">printf</span> <span class="s">"started auction %s for token %s"</span> <span class="p">(</span><span class="n">show</span> <span class="n">a</span><span class="p">)</span> <span class="p">(</span><span class="n">show</span> <span class="n">v</span><span class="p">)</span>
</pre></div>
</div>
<p>Then the <em>bid</em> logic.</p>
<div class="highlight-haskell notranslate"><div class="highlight"><pre><span></span><span class="nf">bid</span> <span class="ow">::</span> <span class="n">forall</span> <span class="n">w</span> <span class="n">s</span><span class="o">.</span> <span class="kt">BidParams</span> <span class="ow">-&gt;</span> <span class="kt">Contract</span> <span class="n">w</span> <span class="n">s</span> <span class="kt">Text</span> <span class="nb">()</span>
<span class="nf">bid</span> <span class="kt">BidParams</span><span class="p">{</span><span class="o">..</span><span class="p">}</span> <span class="ow">=</span> <span class="kr">do</span>
    <span class="p">(</span><span class="n">oref</span><span class="p">,</span> <span class="n">o</span><span class="p">,</span> <span class="n">d</span><span class="o">@</span><span class="kt">AuctionDatum</span><span class="p">{</span><span class="o">..</span><span class="p">})</span> <span class="ow">&lt;-</span> <span class="n">findAuction</span> <span class="n">bpCurrency</span> <span class="n">bpToken</span>
    <span class="n">logInfo</span> <span class="o">@</span><span class="kt">String</span> <span class="o">$</span> <span class="n">printf</span> <span class="s">"found auction utxo with datum %s"</span> <span class="p">(</span><span class="n">show</span> <span class="n">d</span><span class="p">)</span>

    <span class="n">when</span> <span class="p">(</span><span class="n">bpBid</span> <span class="o">&lt;</span> <span class="n">minBid</span> <span class="n">d</span><span class="p">)</span> <span class="o">$</span>
        <span class="n">throwError</span> <span class="o">$</span> <span class="n">pack</span> <span class="o">$</span> <span class="n">printf</span> <span class="s">"bid lower than minimal bid %d"</span> <span class="p">(</span><span class="n">minBid</span> <span class="n">d</span><span class="p">)</span>
    <span class="n">pkh</span> <span class="ow">&lt;-</span> <span class="n">pubKeyHash</span> <span class="o">&lt;$&gt;</span> <span class="n">ownPubKey</span>
    <span class="kr">let</span> <span class="n">b</span>  <span class="ow">=</span> <span class="kt">Bid</span> <span class="p">{</span><span class="n">bBidder</span> <span class="ow">=</span> <span class="n">pkh</span><span class="p">,</span> <span class="n">bBid</span> <span class="ow">=</span> <span class="n">bpBid</span><span class="p">}</span>
        <span class="n">d'</span> <span class="ow">=</span> <span class="n">d</span> <span class="p">{</span><span class="n">adHighestBid</span> <span class="ow">=</span> <span class="kt">Just</span> <span class="n">b</span><span class="p">}</span>
        <span class="n">v</span>  <span class="ow">=</span> <span class="kt">Value</span><span class="o">.</span><span class="n">singleton</span> <span class="n">bpCurrency</span> <span class="n">bpToken</span> <span class="mi">1</span> <span class="o">&lt;&gt;</span> <span class="kt">Ada</span><span class="o">.</span><span class="n">lovelaceValueOf</span> <span class="n">bpBid</span>
        <span class="n">r</span>  <span class="ow">=</span> <span class="kt">Redeemer</span> <span class="o">$</span> <span class="kt">PlutusTx</span><span class="o">.</span><span class="n">toData</span> <span class="o">$</span> <span class="kt">MkBid</span> <span class="n">b</span>

        <span class="n">lookups</span> <span class="ow">=</span> <span class="kt">Constraints</span><span class="o">.</span><span class="n">typedValidatorLookups</span> <span class="n">auctionTypedValidator</span> <span class="o">&lt;&gt;</span>
                  <span class="kt">Constraints</span><span class="o">.</span><span class="n">otherScript</span> <span class="n">auctionValidator</span>                <span class="o">&lt;&gt;</span>
                  <span class="kt">Constraints</span><span class="o">.</span><span class="n">unspentOutputs</span> <span class="p">(</span><span class="kt">Map</span><span class="o">.</span><span class="n">singleton</span> <span class="n">oref</span> <span class="n">o</span><span class="p">)</span>
        <span class="n">tx</span>      <span class="ow">=</span> <span class="kr">case</span> <span class="n">adHighestBid</span> <span class="kr">of</span>
                    <span class="kt">Nothing</span>      <span class="ow">-&gt;</span> <span class="n">mustPayToTheScript</span> <span class="n">d'</span> <span class="n">v</span>                            <span class="o">&lt;&gt;</span>
                                    <span class="n">mustValidateIn</span> <span class="p">(</span><span class="n">to</span> <span class="o">$</span> <span class="n">aDeadline</span> <span class="n">adAuction</span><span class="p">)</span>          <span class="o">&lt;&gt;</span>
                                    <span class="n">mustSpendScriptOutput</span> <span class="n">oref</span> <span class="n">r</span>
                    <span class="kt">Just</span> <span class="kt">Bid</span><span class="p">{</span><span class="o">..</span><span class="p">}</span> <span class="ow">-&gt;</span> <span class="n">mustPayToTheScript</span> <span class="n">d'</span> <span class="n">v</span>                            <span class="o">&lt;&gt;</span>
                                    <span class="n">mustPayToPubKey</span> <span class="n">bBidder</span> <span class="p">(</span><span class="kt">Ada</span><span class="o">.</span><span class="n">lovelaceValueOf</span> <span class="n">bBid</span><span class="p">)</span> <span class="o">&lt;&gt;</span>
                                    <span class="n">mustValidateIn</span> <span class="p">(</span><span class="n">to</span> <span class="o">$</span> <span class="n">aDeadline</span> <span class="n">adAuction</span><span class="p">)</span>          <span class="o">&lt;&gt;</span>
                                    <span class="n">mustSpendScriptOutput</span> <span class="n">oref</span> <span class="n">r</span>
    <span class="n">ledgerTx</span> <span class="ow">&lt;-</span> <span class="n">submitTxConstraintsWith</span> <span class="n">lookups</span> <span class="n">tx</span>
    <span class="n">void</span> <span class="o">$</span> <span class="n">awaitTxConfirmed</span> <span class="o">$</span> <span class="n">txId</span> <span class="n">ledgerTx</span>
    <span class="n">logInfo</span> <span class="o">@</span><span class="kt">String</span> <span class="o">$</span> <span class="n">printf</span> <span class="s">"made bid of %d lovelace in auction %s for token (%s, %s)"</span>
        <span class="n">bpBid</span>
        <span class="p">(</span><span class="n">show</span> <span class="n">adAuction</span><span class="p">)</span>
        <span class="p">(</span><span class="n">show</span> <span class="n">bpCurrency</span><span class="p">)</span>
        <span class="p">(</span><span class="n">show</span> <span class="n">bpToken</span><span class="p">)</span>
</pre></div>
</div>
<p>And finally the <em>close</em> logic.</p>
<div class="highlight-haskell notranslate"><div class="highlight"><pre><span></span><span class="nf">close</span> <span class="ow">::</span> <span class="n">forall</span> <span class="n">w</span> <span class="n">s</span><span class="o">.</span> <span class="kt">CloseParams</span> <span class="ow">-&gt;</span> <span class="kt">Contract</span> <span class="n">w</span> <span class="n">s</span> <span class="kt">Text</span> <span class="nb">()</span>
<span class="nf">close</span> <span class="kt">CloseParams</span><span class="p">{</span><span class="o">..</span><span class="p">}</span> <span class="ow">=</span> <span class="kr">do</span>
    <span class="p">(</span><span class="n">oref</span><span class="p">,</span> <span class="n">o</span><span class="p">,</span> <span class="n">d</span><span class="o">@</span><span class="kt">AuctionDatum</span><span class="p">{</span><span class="o">..</span><span class="p">})</span> <span class="ow">&lt;-</span> <span class="n">findAuction</span> <span class="n">cpCurrency</span> <span class="n">cpToken</span>
    <span class="n">logInfo</span> <span class="o">@</span><span class="kt">String</span> <span class="o">$</span> <span class="n">printf</span> <span class="s">"found auction utxo with datum %s"</span> <span class="p">(</span><span class="n">show</span> <span class="n">d</span><span class="p">)</span>

    <span class="kr">let</span> <span class="n">t</span>      <span class="ow">=</span> <span class="kt">Value</span><span class="o">.</span><span class="n">singleton</span> <span class="n">cpCurrency</span> <span class="n">cpToken</span> <span class="mi">1</span>
        <span class="n">r</span>      <span class="ow">=</span> <span class="kt">Redeemer</span> <span class="o">$</span> <span class="kt">PlutusTx</span><span class="o">.</span><span class="n">toData</span> <span class="kt">Close</span>
        <span class="n">seller</span> <span class="ow">=</span> <span class="n">aSeller</span> <span class="n">adAuction</span>

        <span class="n">lookups</span> <span class="ow">=</span> <span class="kt">Constraints</span><span class="o">.</span><span class="n">typedValidatorLookups</span> <span class="n">auctionTypedValidator</span> <span class="o">&lt;&gt;</span>
                  <span class="kt">Constraints</span><span class="o">.</span><span class="n">otherScript</span> <span class="n">auctionValidator</span>                <span class="o">&lt;&gt;</span>
                  <span class="kt">Constraints</span><span class="o">.</span><span class="n">unspentOutputs</span> <span class="p">(</span><span class="kt">Map</span><span class="o">.</span><span class="n">singleton</span> <span class="n">oref</span> <span class="n">o</span><span class="p">)</span>
        <span class="n">tx</span>      <span class="ow">=</span> <span class="kr">case</span> <span class="n">adHighestBid</span> <span class="kr">of</span>
                    <span class="kt">Nothing</span>      <span class="ow">-&gt;</span> <span class="n">mustPayToPubKey</span> <span class="n">seller</span> <span class="n">t</span>                          <span class="o">&lt;&gt;</span>
                                    <span class="n">mustValidateIn</span> <span class="p">(</span><span class="n">from</span> <span class="o">$</span> <span class="n">aDeadline</span> <span class="n">adAuction</span><span class="p">)</span>       <span class="o">&lt;&gt;</span>
                                    <span class="n">mustSpendScriptOutput</span> <span class="n">oref</span> <span class="n">r</span>
                    <span class="kt">Just</span> <span class="kt">Bid</span><span class="p">{</span><span class="o">..</span><span class="p">}</span> <span class="ow">-&gt;</span> <span class="n">mustPayToPubKey</span> <span class="n">bBidder</span> <span class="n">t</span>                         <span class="o">&lt;&gt;</span>
                                    <span class="n">mustPayToPubKey</span> <span class="n">seller</span> <span class="p">(</span><span class="kt">Ada</span><span class="o">.</span><span class="n">lovelaceValueOf</span> <span class="n">bBid</span><span class="p">)</span> <span class="o">&lt;&gt;</span>
                                    <span class="n">mustValidateIn</span> <span class="p">(</span><span class="n">from</span> <span class="o">$</span> <span class="n">aDeadline</span> <span class="n">adAuction</span><span class="p">)</span>       <span class="o">&lt;&gt;</span>
                                    <span class="n">mustSpendScriptOutput</span> <span class="n">oref</span> <span class="n">r</span>
    <span class="n">ledgerTx</span> <span class="ow">&lt;-</span> <span class="n">submitTxConstraintsWith</span> <span class="n">lookups</span> <span class="n">tx</span>
    <span class="n">void</span> <span class="o">$</span> <span class="n">awaitTxConfirmed</span> <span class="o">$</span> <span class="n">txId</span> <span class="n">ledgerTx</span>
    <span class="n">logInfo</span> <span class="o">@</span><span class="kt">String</span> <span class="o">$</span> <span class="n">printf</span> <span class="s">"closed auction %s for token (%s, %s)"</span>
        <span class="p">(</span><span class="n">show</span> <span class="n">adAuction</span><span class="p">)</span>
        <span class="p">(</span><span class="n">show</span> <span class="n">cpCurrency</span><span class="p">)</span>
        <span class="p">(</span><span class="n">show</span> <span class="n">cpToken</span><span class="p">)</span>
</pre></div>
</div>
<p>There is some code to tie everything up.</p>
<div class="highlight-haskell notranslate"><div class="highlight"><pre><span></span><span class="nf">endpoints</span> <span class="ow">::</span> <span class="kt">Contract</span> <span class="nb">()</span> <span class="kt">AuctionSchema</span> <span class="kt">Text</span> <span class="nb">()</span>
<span class="nf">endpoints</span> <span class="ow">=</span> <span class="p">(</span><span class="n">start'</span> <span class="p">`</span><span class="n">select</span><span class="p">`</span> <span class="n">bid'</span> <span class="p">`</span><span class="n">select</span><span class="p">`</span> <span class="n">close'</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">endpoints</span>
  <span class="kr">where</span>
    <span class="n">start'</span> <span class="ow">=</span> <span class="n">endpoint</span> <span class="o">@</span><span class="s">"start"</span> <span class="o">&gt;&gt;=</span> <span class="n">start</span>
    <span class="n">bid'</span>   <span class="ow">=</span> <span class="n">endpoint</span> <span class="o">@</span><span class="s">"bid"</span>   <span class="o">&gt;&gt;=</span> <span class="n">bid</span>
    <span class="n">close'</span> <span class="ow">=</span> <span class="n">endpoint</span> <span class="o">@</span><span class="s">"close"</span> <span class="o">&gt;&gt;=</span> <span class="n">close</span>
</pre></div>
</div>
<p>And the last lines are just helpers to create a sample NFT to allow us to try the auctioning of this NFT in the playground.</p>
<div class="highlight-haskell notranslate"><div class="highlight"><pre><span></span><span class="nf">mkSchemaDefinitions</span> <span class="kt">''AuctionSchema</span>

<span class="nf">myToken</span> <span class="ow">::</span> <span class="kt">KnownCurrency</span>
<span class="nf">myToken</span> <span class="ow">=</span> <span class="kt">KnownCurrency</span> <span class="p">(</span><span class="kt">ValidatorHash</span> <span class="s">"f"</span><span class="p">)</span> <span class="s">"Token"</span> <span class="p">(</span><span class="kt">TokenName</span> <span class="s">"T"</span> <span class="kt">:|</span> <span class="kt">[]</span><span class="p">)</span>

<span class="nf">mkKnownCurrencies</span> <span class="p">[</span><span class="n">'myToken</span><span class="p">]</span>
</pre></div>
</div>
<p>An example of code reuse is the <em>minBid</em> function.</p>
<div class="highlight-haskell notranslate"><div class="highlight"><pre><span></span><span class="nf">minBid</span> <span class="ow">::</span> <span class="kt">AuctionDatum</span> <span class="ow">-&gt;</span> <span class="kt">Integer</span>
<span class="nf">minBid</span> <span class="kt">AuctionDatum</span><span class="p">{</span><span class="o">..</span><span class="p">}</span> <span class="ow">=</span> <span class="kr">case</span> <span class="n">adHighestBid</span> <span class="kr">of</span>
    <span class="kt">Nothing</span>      <span class="ow">-&gt;</span> <span class="n">aMinBid</span> <span class="n">adAuction</span>
    <span class="kt">Just</span> <span class="kt">Bid</span><span class="p">{</span><span class="o">..</span><span class="p">}</span> <span class="ow">-&gt;</span> <span class="n">bBid</span> <span class="o">+</span> <span class="mi">1</span>
</pre></div>
</div>
<p>This function gets used in the on-chain part for validation, but also in the off-chain code, in the wallet, before it even bothers to create the transaction, to check
whether it is worth doing so.</p>
</div>
</div>
</div>
</div>
<div class="section" id="to-the-playground">
<h2><span class="section-number">1.4. </span>To the Playground<a class="headerlink" href="https://plutus-pioneer-program.readthedocs.io/en/latest/pioneer/week1.html#to-the-playground" title="Permalink to this headline">¶</a></h2>
<p>We will run this contract in our local Plutus Playground.</p>
<div class="section" id="plutus-setup">
<h3><span class="section-number">1.4.1. </span>Plutus Setup<a class="headerlink" href="https://plutus-pioneer-program.readthedocs.io/en/latest/pioneer/week1.html#plutus-setup" title="Permalink to this headline">¶</a></h3>
<p>Before compiling the sample contract code, we need to setup Plutus. It
is advisable to set up a Nix shell from the main Plutus repository at
which can also be used to compile the example contracts.</p>
<p><a class="reference external" href="https://www.evernote.com/shard/s426/client/snv?noteGuid=b34acc67-c94b-fc64-9350-398a8f6fc6ec&amp;noteKey=7e6b84c9501e9949eef2cadf6e35eaff&amp;sn=https%3A%2F%2Fwww.evernote.com%2Fshard%2Fs426%2Fsh%2Fb34acc67-c94b-fc64-9350-398a8f6fc6ec%2F7e6b84c9501e9949eef2cadf6e35eaff&amp;title=Installation">There are detailed notes on how to do this
here</a>.</p>
<p>This will setup your environment with the dependencies necessary to
compile the sample contracts.</p>
<p>Once you are inside the Nix shell, you can start the Plutus client and
server from the cloned Plutus repository.</p>
<p>The lecture videos were recorded at various times and the Plutus code
that goes along with them was compiled against specific commits of the
Plutus main branch. You can find the commit tag in the cabal.project
file.</p>
<div class="section" id="server">
<h4><span class="section-number">1.4.1.1. </span>Server<a class="headerlink" href="https://plutus-pioneer-program.readthedocs.io/en/latest/pioneer/week1.html#server" title="Permalink to this headline">¶</a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> /path/to/plutus/repo/plutus-playground-client
plutus-playground-server
</pre></div>
</div>
</div>
<div class="section" id="client">
<h4><span class="section-number">1.4.1.2. </span>Client<a class="headerlink" href="https://plutus-pioneer-program.readthedocs.io/en/latest/pioneer/week1.html#client" title="Permalink to this headline">¶</a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> /path/to/plutus/repo/plutus-playground-client
npm run start
</pre></div>
</div>
<p>To check that everything is in order, you can then compile the code for
Week 01. This is not necessary to run the code in the playground, as the
playground can compile the code itself.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> /path/to/plutus-pioneer-program/repo/code/week01
cabal build all
</pre></div>
</div>
<p>If all went well in the setup above, you should be able to open the playground at
<a class="reference external" href="https://localhost:8009/">https://localhost:8009</a>. You will likely receive a certificate error,
which can be bypassed.</p>
<div class="figure align-default">
<img alt="Plutus Playground" src="./1. Week 01 - English Auction Plutus Pioneer Program_files/plutus_playground.png">
</div>
<p>Copy and paste the EnglishAuction.sh file contents into the playground,
replacing the existing demo contract.</p>
<div class="figure align-default">
<img alt="Plutus Playground" src="./1. Week 01 - English Auction Plutus Pioneer Program_files/playground_2.png">
</div>
<p>Click the compile button. Once it has compiled, click the Simulate
button.</p>
<div class="figure align-default">
<img alt="Plutus Playground" src="./1. Week 01 - English Auction Plutus Pioneer Program_files/playground_3.png">
</div>
<p>The default wallets are setup with 10 Lovelace and 10 T, where T is a
native token simulated by the script in the following lines:</p>
<div class="highlight-haskell notranslate"><div class="highlight"><pre><span></span><span class="nf">myToken</span> <span class="ow">::</span> <span class="kt">KnownCurrency</span>
<span class="nf">myToken</span> <span class="ow">=</span> <span class="kt">KnownCurrency</span> <span class="p">(</span><span class="kt">ValidatorHash</span> <span class="s">"f"</span><span class="p">)</span> <span class="s">"Token"</span> <span class="p">(</span><span class="kt">TokenName</span> <span class="s">"T"</span> <span class="kt">:|</span> <span class="kt">[]</span><span class="p">)</span>

<span class="nf">mkKnownCurrencies</span> <span class="p">[</span><span class="n">'myToken</span><span class="p">]</span>
</pre></div>
</div>
<p>We are going to treat the token T as a non-fungible token (NFT), and
simulate this by changing the wallets such that Wallet 1 has 1 T and the
other wallets have 0 T.</p>
<p>Also, 10 lovelace is ridiculously low, so let’s give each wallet 1000 Ada, which is 1,000,000,000 lovelace.</p>
<p>Click the “Add Wallet” option, then adjust the balances accordingly:</p>
<div class="figure align-default">
<img alt="Plutus Playground" src="./1. Week 01 - English Auction Plutus Pioneer Program_files/pic__00005.png">
</div>
<p>You can see in the playground that the contract has three endpoints:
start, bid, and close.</p>
<p>The “Pay to Wallet” endpoint is always there by default in the
playground. It allows a simple transfer of Lovelace from one wallet to
another.</p>
<p>Click “start” on wallet 1, to create an auction:</p>
<p>This is where the seller is going to set the rules for the auction.</p>
<p>The getSlot field specifies the deadline for the auction. Bidding after
this deadline will not be allowed by the contract.</p>
<p>Let’s say that the deadline is Slot 10.</p>
<p>Time is measured in POSIX time (seconds since 1st January 1970), so we need to calculate this value. Luckily in the <em>plutus-ledger</em> package in module <em>Ledger.Timeslot</em>,
there is a function <em>slotToPOSIXTime</em>. If we import this into the REPL, we can get the value we need. The simulation starts at the beginning of the Shelley era, so this
value - 1596059101 - reflects that and this will be on July 29th 2020 - the 10th slot of the Shelley era.</p>
<div class="highlight-haskell notranslate"><div class="highlight"><pre><span></span><span class="kt">Prelude</span> <span class="kt">Week01</span><span class="o">.</span><span class="kt">EnglishAuction</span><span class="o">&gt;</span> <span class="kr">import</span> <span class="nn">Ledger.TimeSlot</span>
<span class="kt">Prelude</span> <span class="kt">Ledger</span><span class="o">.</span><span class="kt">TimeSlot</span> <span class="kt">Week01</span><span class="o">.</span><span class="kt">EnglishAuction</span><span class="o">&gt;</span> <span class="n">slotToPOSIXTime</span> <span class="mi">10</span>
<span class="kt">POSIXTime</span> <span class="p">{</span><span class="n">getPOSIXTime</span> <span class="ow">=</span> <span class="mi">1596059101</span><span class="p">}</span>
</pre></div>
</div>
<p>Add this value to the deadline field.</p>
<p>The spMinField specifies the minimum amount of ADA that must be bid. If
this minimum is not met by the deadline, no bid will succeed. Let’s make this 100 Ada.</p>
<p>Enter 100000000 into the spMinBid field.</p>
<p>The last two fields - spCurrencySymbol and unTokenName specify the
currency of the NFT that is the subject of the auction. In Plutus a
native token is defined by a currency symbol and a name.</p>
<p>In this case, the symbol is 66 and the token name, as we have seen is T.</p>
<p>Enter these values into their respective fields.</p>
<div class="figure align-default">
<img alt="Plutus Playground" src="./1. Week 01 - English Auction Plutus Pioneer Program_files/pic__00006.png">
</div>
<p>We can also insert “wait” actions, to wait for a certain number of
slots. We will need to wait for at least one slot in order for the
transaction to start the auction to complete.</p>
<div class="figure align-default">
<img alt="Plutus Playground" src="./1. Week 01 - English Auction Plutus Pioneer Program_files/pic__00007.png">
</div>
<p>Now bidding can start.</p>
<p>Let’s say that Wallets 2 and 3 want to bid for this token.</p>
<p>Wallet 2 is faster, and bids 100 Ada by invoking the bid endpoint
with the parameters as shown below.</p>
<div class="figure align-default">
<img alt="Plutus Playground" src="./1. Week 01 - English Auction Plutus Pioneer Program_files/pic__00008.png">
</div>
<p>We now insert another wait action, and now we add a bid by Charlie (Wallet 3) for 200 Ada.</p>
<div class="figure align-default">
<img alt="Plutus Playground" src="./1. Week 01 - English Auction Plutus Pioneer Program_files/pic__00009.png">
</div>
<p>Let’s say that these two bids are the only bids.</p>
<p>We now add a wait action that will wait until slot 11, which is the slot after the deadline of
the auction.</p>
<div class="figure align-default">
<img alt="Plutus Playground" src="./1. Week 01 - English Auction Plutus Pioneer Program_files/pic__00010.png">
</div>
<p>At this point, anybody can invoke the <em>close</em> endpoint. The auction will
not settle on its own, it needs to be triggered by an endpoint.</p>
<p>When the <em>close</em> endpoint is triggered, the auction will be settled
according to the rules.</p>
<ul class="simple">
<li><p>If there was at least one bid, the highest bidder will receive the
token. This will always be the last bidder as the script will not
allow bids that are not higher than the existing highest bid or bids
that are lower than the minimum bid level.</p></li>
<li><p>If there were no bidders, Wallet 1 will get the token back.</p></li>
</ul>
<p>Let’s say that Alice (Wallet 1) invokes the <em>close</em> endpoint. We will add this
and also add another wait action, which we need at the end in order to
see the final transaction when we run the simulation.</p>
<div class="figure align-default">
<img alt="Plutus Playground" src="./1. Week 01 - English Auction Plutus Pioneer Program_files/pic__00011.png">
</div>
<p>Now, click the “Evaluate” button - either the one at the bottom or the
one at the top of the page.</p>
<p>After a little while, you will see the simulator view.</p>
<p>Towards the top of the page you will see the slots that are relevant to
the simulation, that is, the slots where an action occurred. Here we see
that these are slots 1,2,3,4 and 20.</p>
<p>Slot zero is not caused by our contract, it is the Genesis transaction
that sets up the initial balances of the wallets. There are three
outputs for this transaction.</p>
<div class="figure align-default">
<img alt="Plutus Playground" src="./1. Week 01 - English Auction Plutus Pioneer Program_files/pic__00012.png">
</div>
<p>Now click on the Slot 1 transaction.</p>
<p>The transaction has one input and three outputs. The input is the
only UTxO that Wallet 1 has. Even though it is two tokens, 1000 Ada
and 1T, they sit in one UTxO. As mentioned earlier, UTxOs always need
to be consumed in their entirety, so the entire UTxO is sent as input.</p>
<p>The outputs are a 10 lovelace fee (this is a demo fee and does not reflect what a real fee would be), 999,999,990 lovelace back Wallet 1, and 1 T to the contract to hold
onto while the bidding takes place. Here you also see the script address.</p>
<p>As we know from the introduction to the UTxO model, there can also be a
datum, and there is a datum, but this is not visible in this display.</p>
<div class="figure align-default">
<img alt="Plutus Playground" src="./1. Week 01 - English Auction Plutus Pioneer Program_files/pic__00013.png">
</div>
<p>So now the auction is set up, let’s look at the next transaction, where
Bob (Wallet 2) makes a bid of 100 Ada.</p>
<p>There are two inputs - the script UTxO and the UTxO that Bob owns.</p>
<p>There are also three outputs. The first is a fee of 14,129 lovelace. The second gives Bob his change - his original sum minus the fees and bid. The third
output locks the bid into the contract.</p>
<p>The script validator here must make sure that Wallet 2 can’t just take
the token, so it will only validate in a scenario where there is an
output where the token ends up in the contract again. Remember that in
the (E)UTxO model, all inputs and outputs are visible to the script.</p>
<div class="figure align-default">
<img alt="Plutus Playground" src="./1. Week 01 - English Auction Plutus Pioneer Program_files/pic__00014.png">
</div>
<p>Now let’s look at the next transaction. This is where Charlie bids 200 Ada
Lovelace (it is 5 Lovelace in Lars’ videos, but I entered it as 4 and
I’d rather not take all those screenshots again).</p>
<p>The inputs here are Wallet 3’s UTxO and the script address.</p>
<p>The outputs are the change of 6 Lovelace to Wallet 3, the updated script
with the new high bid of 4 Lovelace, and the return of Wallet 2’s bid of
3 Lovelace to Wallet 2’s address.</p>
<p>Again, the logic in the script must make sure that all of this is
handled correctly, i.e. that the new bid is higher than the previous bid
and that the token T continues to be locked in the contract along with
the new bid.</p>
<div class="figure align-default">
<img alt="Plutus Playground" src="./1. Week 01 - English Auction Plutus Pioneer Program_files/pic__00015.png">
</div>
<p>The last transaction is the <em>close</em> action. This two inputs - one from Alice
in order to pay for the fees, and the second is the script UTxO as input. There are four outputs - the fees from Alice and the change back to Alice,
and then the successful bid of 200 Ada to Alice and the transfer of the NFT to Charlie.</p>
<div class="figure align-default">
<img alt="Plutus Playground" src="./1. Week 01 - English Auction Plutus Pioneer Program_files/pic__00016.png">
</div>
<p>If we scroll down, we can now see the final balances.</p>
<div class="figure align-default">
<img alt="Plutus Playground" src="./1. Week 01 - English Auction Plutus Pioneer Program_files/pic__00017.png">
</div>
<p>Let’s check what happens when something goes wrong, for example, if Charlie makes a bid that is lower than Bob’s bid. Let’s say Charlie makes a mistake and bids
only 20 Ada.</p>
<p>Now we see that we have only four transactions, and Bob wins the auction.</p>
<div class="figure align-default">
<img alt="Plutus Playground" src="./1. Week 01 - English Auction Plutus Pioneer Program_files/pic__00018.png">
</div>
<p>Let’s see what happens if there are no valid bids.</p>
<div class="figure align-default">
<img alt="Plutus Playground" src="./1. Week 01 - English Auction Plutus Pioneer Program_files/pic__00019.png">
</div>
<p>Now there are only three transactions, the last of which is the close transaction. As this is a failed auction, where there was no successful bid, this transaction returns the
NFT to Wallet 1.</p>
<div class="figure align-default">
<img alt="Plutus Playground" src="./1. Week 01 - English Auction Plutus Pioneer Program_files/pic__00020.png">
</div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="https://plutus-pioneer-program.readthedocs.io/en/latest/pioneer/week2.html" class="btn btn-neutral float-right" title="2. Week 02 - Validation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="https://plutus-pioneer-program.readthedocs.io/en/latest/index.html" class="btn btn-neutral float-left" title="Plutus Pioneer Program &amp; Alonzo Testnet Notes" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr><div><div id="rtd-sidebar" data-ea-publisher="readthedocs" data-ea-type="readthedocs-sidebar" data-ea-manual="true" class="ethical-rtd" data-ea-keywords="only words|readthedocs-project-655784|readthedocs-project-plutus-pioneer-program" data-ea-campaign-types="community|house|paid"></div></div>

  <div role="contentinfo">
    <p>
        © Copyright .
      <span class="commit">
        
        Revision <code>1d0b94a2</code>.
      </span>

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org/">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Read the Docs</span>
      v: latest
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions"><!-- Inserted RTD Footer -->

<div class="injected">

  

      
      
      
      <dl>
        <dt>Các phiên ban</dt>
        
        <dd class="rtd-current-item">
          <a href="https://plutus-pioneer-program.readthedocs.io/en/latest/pioneer/week1.html">latest</a>
        </dd>
        
      </dl>
      
      

      
      
      <dl>
        <dt>Downloads</dt>
        
        <dd><a href="https://plutus-pioneer-program.readthedocs.io/_/downloads/en/latest/pdf/">PDF</a></dd>
        
        <dd><a href="https://plutus-pioneer-program.readthedocs.io/_/downloads/en/latest/epub/">Epub</a></dd>
        
      </dl>
      
      

      
      <dl>
        
        <!-- These are kept as relative links for internal installs that are http -->
        <dt>On Read the Docs</dt>
        <dd>
          <a href="https://readthedocs.org/projects/plutus-pioneer-program/">Project Home</a>
        </dd>
        <dd>
          <a href="https://readthedocs.org/projects/plutus-pioneer-program/builds/">Các phiên bản xây dựng</a>
        </dd>
        <dd>
          <a href="https://readthedocs.org/projects/plutus-pioneer-program/downloads/">Downloads</a>
        </dd>
      </dl>
      

      

      
      <dl>
        <dt>On GitHub</dt>
        <dd>
          <a href="https://github.com/chris-moreton/plutus-pioneer-program/blob/main/docs/pioneer/week1.rst">View</a>
        </dd>
        
        <dd>
          <a href="https://github.com/chris-moreton/plutus-pioneer-program/edit/main/docs/pioneer/week1.rst">Chỉnh sửa</a>
        </dd>
        
      </dl>
      
      

      
      <dl>
        <dt>Tìm kiếm</dt>
        <dd>
          <div style="padding: 6px;">
            
            <form id="flyout-search-form" class="wy-form" target="_blank" action="https://readthedocs.org/projects/plutus-pioneer-program/search/" method="get">
              <input type="text" name="q" aria-label="Search docs" placeholder="Search docs">
              </form>
          </div>
        </dd>
      </dl>
      

      <hr>

      
        <small>
          <span>Hosted by <a href="https://readthedocs.org/">Read the Docs</a></span>
          <span> · </span>
          <a href="https://docs.readthedocs.io/page/privacy-policy.html">Privacy Policy</a>
        </small>
      

      

</div>
</div>
  </div>


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
   


</body><div style="position: absolute; top: 0px;"></div></html>